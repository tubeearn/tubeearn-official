<!-- index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TubeEarn Admin Dashboard</title>
  <style>
    body { font-family: sans-serif; background: #f0f0f0; margin: 0; padding: 20px; }
    h1 { color: #333; }
    .card { background: white; padding: 20px; margin-bottom: 15px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);}
    .card h2 { margin: 0 0 10px; }
  </style>
</head>
<body>
  <h1>TubeEarn Real Admin Dashboard</h1>

  <div class="card" id="revenueCard"><h2>Total Revenue</h2><p id="revenue">Loading...</p></div>
  <div class="card" id="videosCard"><h2>Total Videos</h2><p id="videos">Loading...</p></div>
  <div class="card" id="shortsCard"><h2>Total Shorts</h2><p id="shorts">Loading...</p></div>
  <div class="card" id="subsCard"><h2>Total Subscribers</h2><p id="subs">Loading...</p></div>
  <div class="card" id="walletCard"><h2>Total Wallet Balance</h2><p id="wallet">Loading...</p></div>
  <div class="card" id="storageCard"><h2>Cloud Storage Memory Used</h2><p id="storage">Loading...</p></div>

  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

    const supabaseUrl = 'https://ejbvidirnsjvadvekede.supabase.co'
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVqYnZpZGlybnNqdmFkdmVrZWRlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM2MTA3ODMsImV4cCI6MjA2OTE4Njc4M30.KoCt8f2bXjn3843XOsRMLwyZ0lKpARkrRqb_GXlGfUs'

    const supabase = createClient(supabaseUrl, supabaseKey)

    async function fetchDashboardData() {
      // Fetch revenue
      let { data: revenueData, error: revenueError } = await supabase.from('revenue').select('amount')
      let totalRevenue = revenueData?.reduce((sum, item) => sum + (item.amount || 0), 0) || 0
      document.getElementById("revenue").innerText = "₹ " + totalRevenue

      // Fetch videos
      let { data: videosData, error: videosError } = await supabase.from('videos').select('id')
      document.getElementById("videos").innerText = videosData?.length || 0

      // Fetch shorts
      let { data: shortsData, error: shortsError } = await supabase.from('shorts').select('id')
      document.getElementById("shorts").innerText = shortsData?.length || 0

      // Fetch subscribers
      let { data: subsData, error: subsError } = await supabase.from('users').select('id')
      document.getElementById("subs").innerText = subsData?.length || 0

      // Fetch wallet balance
      let { data: walletData, error: walletError } = await supabase.from('wallet').select('balance')
      let totalWallet = walletData?.reduce((sum, w) => sum + (w.balance || 0), 0) || 0
      document.getElementById("wallet").innerText = "₹ " + totalWallet

      // Storage Usage (Cloud)
      const { data: files, error: storageError } = await supabase.storage.from('wallet-transactions').list('', {limit:100})
      let totalSizeBytes = 0
      for (const file of files) totalSizeBytes += file.metadata?.size || 0
      const totalSizeMB = (totalSizeBytes / (1024 * 1024)).toFixed(2)
      document.getElementById("storage").innerText = `${totalSizeMB} MB used`
    }

    fetchDashboardData()
  </script>
</body>
</html>
